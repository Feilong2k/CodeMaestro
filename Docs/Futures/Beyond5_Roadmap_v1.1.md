# Beyond5 Roadmap v1.1

## Overview
This roadmap outlines the evolution of Orion’s architecture and capabilities beyond Phase 5, focusing on three sequential milestones:

1. **Two‑Tiered Consultative Brain** – Replace the current split‑brain routing with a unified first‑level brain (DeepSeek‑Reasoner) that can consult a second‑level specialist for architectural decisions via a manifest‑driven workflow.
2. **Critical Tool Improvements & Enhanced UX** – Equip the first‑level brain with the tool‑calling fluency of Cline/Cursor and add a tabbed UI panel for real‑time reasoning visibility and document interaction.
3. **Phase 6 Body Awareness** – Implement system‑level health checks, monitoring, and resilience features.

Each milestone builds on the previous one, ensuring foundational changes are stable before adding complexity.

---

## Milestones

### Milestone 1: Two‑Tiered Brain Structure (Weeks 1‑2)
**Goal**: Deliver a unified chat experience where Orion understands natural‑language requests directly, can self‑diagnose uncertainty, and consults a specialist only when needed.

**Deliverables**:
1. `UnifiedAdapter` – A single LLM adapter using DeepSeek‑Reasoner with function‑calling for all tools, **outputting JSON reasoning** (thoughts, actions, parameters) for full visibility.
2. **First‑Brain Prompt** – Comprehensive prompt with:
   - Identity & core instructions.
   - Project context (directory tree, key config files).
   - **Tool guide** – each tool described with when‑to‑use scenarios and concrete examples (e.g., “User: create a todo.md file → Assistant calls FileSystemTool.write”).
   - Examples of clarification questions generated by the first brain itself.
   
   NOTES: Make Orion1 judge if the request is actionable? confidence? and clarification. If actionable, should it be multistepped? also should these data be saved for future anlaysis and improvements?
   
   **Answer:** Yes – the router (or the first brain itself) should judge actionability as part of intent classification.  
   - **Actionable** = the request can be executed with available tools.  
   - **Confidence** = how sure the classifier is about the intent (`change` vs `design/refactor`).  
   - **Multi‑step detection** is a separate heuristic; the first brain can decide whether to break the task into steps after reading relevant files.  
   - **Data logging** is essential: store classification results, confidence scores, clarification questions, and eventual success/failure. This data will be used to retune the router and improve the prompt.

3. **Confidence‑Driven Clarification Loop**:
   - Lightweight router classifies intent (`change` vs `design/refactor`) with a confidence score.
   - If confidence < 80%, the router prompts the first brain to generate a concise clarification question.
   - The question is presented to the user; the answer is used to re‑evaluate intent.

NOTES: is 80% a relevant number, should it be higher or lower?

**Answer:** 80% is a reasonable starting point. It’s a tunable hyper‑parameter that should be adjusted after observing real‑world performance.  
- Too high (>90%) → too many clarifications, frustrating delays.  
- Too low (<70%) → mis‑routing, wasted cycles.  
- **Recommendation:** Make the threshold configurable and track the false‑positive/false‑negative rate; we can adjust it after a week of usage.

4. **Manifest‑Driven Consultation**:
   - For high‑confidence design/refactor requests, the first brain creates a **manifest** (JSON listing files, dependencies, approach).
   
   NOTES: a generic JSON design for all matters that needs to be escalated? or one JSON per type? and what context will be transferred to the next tier?

   **Answer:** Use a **generic JSON schema** that can cover all escalation types. The manifest should include:  
   ```json
   {
     "intent": "string",
     "files": [{"path": "...", "operation": "...", "purpose": "..."}],
     "dependencies": [],
     "approach": "string",
     "context": {
       "relevantFileSnippets": ["..."],
       "conversationSummary": "string",
       "knownConstraints": []
     }
   }
   ```  
   **Context transferred:** The manifest plus any additional context the first brain deems relevant (relevant code snippets, conversation summary, known constraints). The second brain needs enough context to run a meaningful CDP analysis.

   - The manifest is sent to the `StrategicConsultant` (second‑level brain) for advisory analysis (not a boolean gatekeeper).
   - The consultant returns a structured **advisory report** (constraints discovered, gaps, conditions) that is presented to the user for decision.

    NOTES: Including recommendations that's outside of CDP?

    **Answer:** Yes, the second brain’s advisory report should have a separate `recommendations` field that includes architectural patterns, technology choices, security best practices, performance optimizations, etc., beyond the pure constraint‑discovery findings. This makes the consultation more valuable.

5. Updated `OrionAgent.chat` – Removes tactical/strategic routing heuristics; uses the new clarification loop, manifest flow, and JSON‑reasoning‑enabled `UnifiedAdapter`. Keeps local router only for explicit commands (`list docs`, `read Docs/…`).

    NOTES: is it really need it? would it not interfere with the tier1 working?

    **Answer:** The local router is **optional but beneficial** for performance on explicit, structured commands (`list docs`, `read Docs/…`). It should be designed as a **fast path** that only triggers for specific command patterns and bypasses the LLM entirely. It will not interfere with tier‑1 if it’s used only when the message matches a simple regex pattern; otherwise, the request flows to the first brain normally.


**Acceptance Criteria**:
- User can say “Refactor the chat panel to use virtual scrolling” and Orion automatically decomposes the task, outputs its reasoning as JSON, and optionally consults the specialist (presenting the advisory report).
- When a request is ambiguous (“Can you make a todo list?”), Orion asks a tailored clarification question (e.g., “Do you want me to create a todo.md file, or just explain how?”).
- System Log shows JSON reasoning steps, clarification events, and consultation advisories.
- The first brain correctly uses tools based on the examples in the prompt (e.g., creates files, reads files, runs git commands).

### Milestone 2: Critical Tool Improvements & Enhanced UX (Weeks 3‑4)
**Goal**: Equip the first‑level brain with the tools that make Cline/Cursor so effective, and provide a rich UI for observing and interacting with Orion’s thought process.

**Deliverables**:
1. **Enhanced FileSystemTool** – Add `search` (grep) and `fileTree` navigation.
    
    NOTES: Can we prompt Orion that he can search datbase for examples on how to use a tool? or provide him with a link to a file?

    **Answer:** Yes. Enhance the prompt with:  
    - Instructions to search the codebase (using the enhanced `FileSystemTool.search`) for examples of tool usage.  
    - A static “tool‑examples” file (e.g., `Docs/FirstBrain_ToolGuide.md`) that Orion can read when unsure.  
    - A new **`searchContext` tool** that queries a vector database of project documentation and previous decisions (future enhancement).

    NOTES: What other tools does he need? like inserting data into a file at a specific locaiton?

    **Answer:** Key additional tools:  
    - **File edit/insert tool** (`FileSystemTool.insertAt` or a generic `editFile` that applies a patch).  
    - **Code analysis tool** – run linters, type‑checkers and report errors.  
    - **Dependency management tool** – add/remove packages via npm/pip.  
    - **Process management tool** – start/stop services (e.g., development server).  
    We should prioritize the edit/insert tool for Milestone 2; others can be added later.

2. **Project‑Awareness Tool** – Reads `package.json`, `tsconfig.json`, `.gitignore` etc. to inform the LLM about project structure and dependencies.

3. **Multi‑Step Session Tool** – Maintains a goal stack and progress within a conversation (enables “now update the CSS too” without re‑explaining).
    NOTS: Is this like a task queue? 

    **Answer:** Exactly. The Multi‑Step Session Tool maintains a **goal stack** (a queue of subtasks) and tracks progress within a conversation. It allows Orion to resume where it left off, handle “now update the CSS too” seamlessly, and provide progress updates to the user.

4. **Frontend Tabbed Panel** – Extend the existing UI (likely `StatusBar.vue`) with three tabs:
   - **Activity Log** – Current activity stream (what Orion is doing).
   - **System Log** – Existing WebSocket events (infrastructure, errors).
   - **Orion’s Workspace** – A two‑way communication panel where:
     - *Thought Process*: Live feed of Orion’s JSON reasoning, formatted as a collapsible tree.
     - *Document Viewer*: Orion can push Markdown, text, or HTML documents (e.g., generated CDP results, manifests, architecture diagrams) and they are rendered here.
     - *User Interaction*: Users can expand/collapse sections, view documents, and provide feedback.
        NOTES: is Document viewer, and the user interaction hard to do? make the views sizable

        **Answer:** Moderate complexity but achievable with Vue.  
        - Use existing libraries: `marked` for Markdown, `vue‑json‑pretty` for JSON tree rendering.  
        - Make the panels resizable using Vue’s `splitpanes` or CSS `resize`.  
        - The main challenge is WebSocket integration and state management, but we already have similar infrastructure (chat store, system‑log streaming).  
        - **Recommendation:** Start with a fixed‑height panel and add resize later if time permits.

5. **New Tool `displayDocument`** – Allows Orion to send content to the Workspace tab (payload: `{ title, content, format }`).

6. **Enhanced Prompt** – Add layers for project‑awareness and multi‑step session guidance.
    NOTES: how do we train Orion to search DB for context?

    **Answer:** Two‑pronged approach:  
    1. **Prompt engineering** – Include instructions like: “If you need broader context about the project (past decisions, architecture documents), use the `searchContext` tool.”  
    2. **Tool implementation** – Build a `searchContext` tool that queries a vector database (e.g., Chroma or Pinecone) indexed with project documentation, ADRs, and previous consultation results. This is a Milestone 2 or 3 feature.

**Acceptance Criteria**:
- User can say “Find all uses of `useFocus` in the codebase” and Orion returns a list of files and lines (using the enhanced search).
- Orion knows the project is Vue 3 + TypeScript and tailors its suggestions accordingly.
- Complex refactors are handled as a single session with step‑by‑step progress tracked.
- The tabbed UI displays Orion’s real‑time reasoning and allows the user to view generated documents (e.g., a manifest or CDP report) inline.

### Milestone 3: Phase 6 Body Awareness (Weeks 5‑6)
**Goal**: Make Orion self‑monitoring and resilient.

**Deliverables**:
1. **Health‑Check Service** – Periodic validation of LLM API connectivity, database latency, disk space, and tool availability.
2. **System‑Log Dashboard** – Real‑time visualization of agent states, consultation calls, and constraint‑discovery findings (integrates with the new tabbed UI).
3. **Circuit‑Breaker Patterns** – Automatic fallback to mock modes or cached responses when external services are down.
4. **Performance Metrics** – Track response latency, tool‑call success rates, and consultation costs.

**Acceptance Criteria**:
- Orion logs a warning when DeepSeek‑Reasoner API latency exceeds 5 s.
- The dashboard shows a live stream of state transitions (`OBSERVE` → `THINK` → `ACT`).
- If Gemini‑3 is unavailable, consultations gracefully degrade to a local rule‑based checklist.
- Weekly report of API usage, error rates, and user satisfaction (via implicit signals).

---

NOTES: Shouldn't the below be also included
    Task 6-4: Shell Output Streaming & Structured Errors
    Task 6-5: Proprioception & Context Wiring (First Slice)

**Answer:** Yes, both should be included.  
- **Task 6‑4 (Shell Output Streaming & Structured Errors)** is crucial for user feedback; it belongs in **Milestone 2** as part of the enhanced UX (streaming tool outputs to the Activity Log).  
- **Task 6‑5 (Proprioception & Context Wiring)** is about system self‑awareness and belongs in **Milestone 3 (Body Awareness)** as it involves wiring internal state to the health‑check service and system log.  
We'll add these two tasks to the respective milestones in the next version of the roadmap.


## Key Design Decisions (Incorporated from Planning Discussions)

### 1. **First‑Brain‑Generated Clarification**
- No hard‑coded clarification questions. When the router’s confidence is low, it asks the first brain “What single question could I ask to clarify the user’s intent?” and uses the generated question.
- The same mechanism works for “intent unclear” scenarios (router cannot decide between change/design).

### 2. **JSON Reasoning Output**
- Every thought, tool‑call decision, and parameter is output in a structured JSON array (`reasoning`), enabling full visibility into Orion’s cognitive process.
- This output is logged to the database and streamed to the frontend’s **Orion’s Workspace** tab.

### 3. **Manifest‑Driven Advisory Consultation**
- The first brain creates a manifest (not code) for complex requests.
- The second brain returns an **advisory report** (not a boolean), presenting constraints, gaps, and conditions. The final decision stays with the human (or the first brain after user input).

### 4. **Tool‑Guide in Prompt**
- The prompt includes concrete examples of tool usage, each showing the thought process, the tool call, and the rationale. Examples are language‑agnostic and cover common scenarios (create file, read file, git status, run tests, ask clarification).

### 5. **Interactive UI Panel**
- The new **Orion’s Workspace** tab serves as Orion’s “mouth to the world”—it displays his thoughts, generated documents, and allows the user to inspect them without cluttering the chat window.

---

## Constraint Discovery Protocol Analysis (Full v4)
*Note: This section is carried forward from v1.0 and has not been updated per the user’s request to skip the CDP portion in this revision.*

[The original CDP analysis from v1.0 is included here verbatim for reference.]

---

*Document generated by Adam (Architect) on 2025‑12‑09. Last updated: 2025‑12‑10 (v1.1 with answers).*
