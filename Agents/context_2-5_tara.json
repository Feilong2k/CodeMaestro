{
  "role": "tester",
  "system_instruction": "",
  "task_context": {
    "subtask_id": "2-5",
    "content_raw": "id: \"2-5\"\r\ntitle: \"Deepseek Integration\"\r\nstatus: pending\r\noutcome: pending\r\nbranch: \"subtask/2-5-deepseek-integration\"\r\ndependencies: [\"2-4\"]\r\nrelevantFiles:\r\n  - \"backend/src/llm/DeepseekClient.js\"\r\n  - \"backend/src/llm/ModelAdapter.js\"\r\n  - \"backend/.env\"\r\nrequiredActions:\r\n  - \"API Client: DeepseekClient class\"\r\n  - \"Model Adapter: Abstract interface (swap for OpenAI/Anthropic later)\"\r\n  - \"Config: API key from env, model selection\"\r\n  - \"Rate Limiting: Respect API limits\"\r\n  - \"Token Tracking: Log usage per request\"\r\n  - \"Error Handling: Timeout, rate limit, auth errors\"\r\nverificationChecklist:\r\n  - \"[ ] [TDD] Failing Unit Tests created (Red)\"\r\n  - \"[ ] [TDD] Implementation satisfies Unit Tests (Green)\"\r\n  - \"[ ] [TDD] Refactor pass (Cleanup)\"\r\n  - \"[ ] [TDD] Integration Tests (Red ‚Üí Green)\"\r\n  - \"[ ] [TDD] Final verification and coverage > 80%\"\r\n  - \"[ ] API calls succeed with valid key\"\r\n  - \"[ ] Errors handled gracefully\"\r\n  - \"[ ] Token usage logged\"\r\nprChecklist:\r\n  developer: []\r\n  tester: []\r\nprChecklistStatus:\r\n  developer: pending\r\n  tester: pending\r\n  orchestrator: pending\r\nopenQuestions: []\r\nnotes:\r\n  - \"Deepseek API is OpenAI-compatible. Use deepseek-coder or deepseek-chat model.\"\r\n  - \"‚ö†Ô∏è BRANCH CHECK: Run 'git branch' - must show * subtask/2-5-deepseek-integration\"\r\n  - \"TARA INSTRUCTIONS (Create failing tests - Red):\"\r\n  - \"  - Create backend/__tests__/unit/deepseek.test.js\"\r\n  - \"  - Test: DeepseekClient class initialization with API key\"\r\n  - \"  - Test: chat() method sends request and returns response\"\r\n  - \"  - Test: Rate limit handling (429 response ‚Üí retry with backoff)\"\r\n  - \"  - Test: Auth error handling (401 response)\"\r\n  - \"  - Test: Timeout handling\"\r\n  - \"  - Test: Token usage tracking\"\r\n  - \"  - Test: ModelAdapter interface (abstract class)\"\r\n  - \"  - Mock HTTP calls - do NOT hit real API\"\r\nlastUpdated: 2025-12-05T03:00:00Z\r\nupdatedBy: orion\r\n\r\n"
  },
  "rules": {
    "general": "# CodeMaestro Rules & Standards\r\n\r\nThis document serves as the Single Source of Truth for static rules, standards, and conventions in the CodeMaestro repository.\r\nAll agents (Architect, Developer, Tester) must adhere to these guidelines.\r\n\r\n---\r\n\r\n## 1. Task Creation Rules\r\n\r\n### Overview\r\nStandard format for creating development tasks to ensure consistency and tracking.\r\n\r\n### Task Format Structure\r\n```\r\n## Task #[number] - [Task Title] [icon]\r\n‚îÇ\r\n‚îÇ   Priority: [priority]  Status: [status]\r\n‚îÇ   Dependencies: [dependency list]\r\n‚îÇ\r\n‚îÇ   Description: [Detailed task description covering what needs to be implemented]\r\n‚îÇ\r\n‚îÇ   Acceptance Criteria:\r\n‚îÇ   - [Criterion 1 - specific, testable requirement]\r\n‚îÇ   - [Criterion 2 - specific, testable requirement]\r\n```\r\n\r\n### Required Components\r\n1.  **Task Numbering**: Sequential (1, 2, 3...). Global scope.\r\n2.  **Task Title**: Clear, action-oriented (3-8 words).\r\n3.  **Icons**: ‚öôÔ∏è (Backend), üîí (Security), üé® (UI/Frontend), etc.\r\n4.  **Priority**: üî¥ High, üü° Medium, üü¢ Low.\r\n5.  **Status**: ‚óã pending, ‚óè in progress, ‚úì completed.\r\n6.  **Dependencies**: List blocking tasks by number.\r\n7.  **Acceptance Criteria**: 3-5 specific, testable outcomes.\r\n\r\n### Code Quality & TDD Rules\r\n- **Refactor Every Subtask**: You must perform a \"Refactor Pass\" (cleanup, renaming, de-duplication) *after* tests pass (Green) but *before* marking the subtask as ready.\r\n- **Sad Path Testing**: Every feature must include at least one test case for failure/error scenarios.\r\n- **Test Coverage**: Aim for ~80% coverage on new code.\r\n\r\n### Task Lifecycle & Immutability (The \"Closed is Closed\" Rule)\r\n- **Immutable Completion**: Once a subtask is marked `completed` (checked off in manifest/logs), it is **frozen**.\r\n- **No Scope Creep**: Do not add \"just one more thing\" to a closed task.\r\n- **New Req = New Task**: If you have a new requirement (e.g., \"Use this new template for FRD\"), you MUST create a **new subtask** (e.g., `2-2-14-update-frd-template` or `2-2-3-b-template-support`).\r\n  - *Why?* AI agents look at `completed` status and move on. They will ignore context for closed tasks.\r\n\r\n---\r\n\r\n## 2. Role Boundaries (Tester vs Developer)\r\n\r\n### Testers (Tara)\r\n- **Scope**: Create/modify **test artifacts only**.\r\n  - `__tests__/`, `*.spec.ts`, `*.test.js`, fixtures, mocks.\r\n- **Restriction**: Must **not** edit implementation/source files. Request changes via comments/tasks.\r\n\r\n### Developers (Devon)\r\n- **Scope**: Create/modify **implementation/source files only**.\r\n  - `src/**`, components, services, controllers.\r\n- **Restriction**: Must **not** edit test files. Request changes to tests via Tester.\r\n\r\n**Note**: One subtask ‚Üí One branch ‚Üí One PR. Assign appropriately.\r\n\r\n---\r\n\r\n## 3. Naming Conventions\r\n\r\n### Implementation Files\r\n- **Backend (Node/Express)**:\r\n    - **Files**: lowerCamelCase (e.g., `orionClient.js`).\r\n    - **Folders**: lower-case or kebab-case.\r\n    - **Suffixes**: `*Routes.js`, `*Controller.js`, `*Service.js`.\r\n- **Frontend (Vue 3)**:\r\n    - **Components**: PascalCase `.vue` (e.g., `ChatTranscript.vue`).\r\n    - **Composables**: `useXxx` camelCase.\r\n\r\n### Test Files\r\n- **Backend (Jest)**:\r\n    - `backend/__tests__/unit/**`\r\n    - Names: mirror subject + `.test.js` (e.g., `orionClient.test.js`).\r\n- **Frontend (Vitest)**:\r\n    - `frontend/src/__tests__/**`\r\n    - Names: `<ComponentName>.spec.ts` or `<useName>.spec.ts`.\r\n\r\n---\r\n\r\n## 4. Shell/CLI Conventions (PowerShell)\r\n- **Default Shell**: PowerShell on Windows.\r\n- **Syntax**:\r\n    - Use `;` for sequential commands (not `&&`).\r\n    - Use backtick `` ` `` for line continuation.\r\n    - Env vars: `$env:VAR = \"value\"`.\r\n- **Process**: Prefer `Start-Process` or direct invocation.\r\n",
    "testing": "# Tester Workflows & Rules ‚Äî Tara (QA)\r\n\r\nVersion: 1.1\r\nOwner: Adam (Architect)\r\nStatus: Adopted\r\n\r\nThis document defines how testers create and stabilize tests per subtask so tests fail for the right reasons and provide clear, actionable feedback.\r\n\r\n---\r\n\r\n## 0) Scope & Role Boundaries (recap)\r\n- Testers may create/modify **test artifacts only**:\r\n  - `__tests__/`, `*.test.js|ts`, `*.spec.js|ts`, fixtures under `__fixtures__/`, mocks under `__mocks__/`, and test setup files (e.g., `jest.setup.js`).\r\n- Testers must **not** edit implementation/source files (services, controllers, routes, UI components). Request changes via the Developer subtask or PR comments.\r\n- **Handling Missing Files:** If an implementation file does not exist yet (e.g., `src/components/NewComp.vue`), you **MUST** create the test file (`src/__tests__/NewComp.spec.js`) and import the missing component.\r\n  - This will cause the test to crash/fail. **This is the desired \"Red\" state.**\r\n  - Do not wait for the developer to create the file. You define the contract; they fulfill it.\r\n\r\n---\r\n\r\n## 1) Sequencing (per subtask)\r\nFollow this order to minimize flaky or mis-specified tests:\r\n1) Unit tests first (pure logic, no external HTTP):\r\n   - Validation utilities, schema checks\r\n   - Error mapping functions\r\n   - Client wrappers at the boundary (constructor, call contract) using a mocked HTTP client\r\n2) Integration tests second (endpoint/flow):\r\n   - Use Supertest (backend) or equivalent\r\n   - Mock external adapters (e.g., `orionClient`) explicitly\r\n3) Optional E2E last (smoke only), after unit/integration are green\r\n\r\nNotes:\r\n- It‚Äôs OK to scaffold both unit and integration test files early; stabilize and trust unit tests **before** integration.\r\n- All mocks must be explicit and localized (e.g., `backend/__tests__/__mocks__/orionClient.js`).\r\n\r\n---\r\n\r\n## 2) Test Layout & Naming\r\n- Backend (Jest):\r\n  - Unit: `backend/__tests__/unit/**`\r\n  - Integration: `backend/__tests__/integration/**`\r\n  - File names mirror subject with `.test.js` (or `.spec.js`) suffix, e.g., `orionClient.test.js`, `orionChatController.test.js`.\r\n  - Fixtures/mocks: `backend/__tests__/__fixtures__`, `backend/__tests__/__mocks__`\r\n- Frontend (Vitest):\r\n  - `frontend/src/__tests__/**`\r\n  - Components: `<ComponentName>.spec.ts|js`\r\n  - Composables: `<useName>.spec.ts|js`\r\n\r\nBe consistent within each package with either `.test.*` or `.spec.*`.\r\n\r\n---\r\n\r\n## 3) Mocking Guidelines\r\n- Never hit external services (e.g., DeepSeek) in tests.\r\n- Mock adapters at the boundary (e.g., `orionClient`) and assert how the system handles:\r\n  - Success payload shape\r\n  - Rate-limits (`429` with `retryAfter`)\r\n  - Content policy errors (`400 CONTENT_FILTER_ERROR`)\r\n  - Service outages (`503 SERVICE_UNAVAILABLE`)\r\n  - Unknown failures (`500 INTERNAL_ERROR`)\r\n- Place common mocks in `__mocks__/` and reference via Jest‚Äôs moduleNameMapper or explicit requires.\r\n\r\n---\r\n\r\n## 4) Stability Rules (Good Red vs Bad Red)\r\n- Good Red: failing because an unimplemented behavior is clearly specified in the Implementation Requirements (e.g., message length > 2000 rejects).\r\n- Bad Red: failing due to test bugs, unclear assumptions, or flaky timing. Fix tests/mocks first.\r\n- Before opening a PR:\r\n  - Ensure unit tests fail **for clearly documented reasons** (link to requirement section)\r\n  - Run unit tests only, stabilize them, then enable integration tests\r\n\r\n---\r\n\r\n## 5) Assertions & Setup\r\n- Custom matchers live in `backend/jest.setup.js` (e.g., `toBeString`, `toBeISO8601`)\r\n- Prefer precise assertions on:\r\n  - HTTP status, error code, message, `retryAfter`\r\n  - Payload fields: `response`, `messageId`, `timestamp`, `usage`, `finishReason`\r\n- Avoid asserting on brittle internals (e.g., exact prompt text)\r\n\r\n---\r\n\r\n## 6) TDD Checklist (include in PR)\r\n- [ ] Quick Test Report attached (use .clinerules/workflows/templates/TestReport_Quick.md)\r\n- [ ] Failing unit tests written (validation, error mapper, adapter boundary)\r\n- [ ] Unit tests green\r\n- [ ] Failing integration tests written (endpoint happy + error paths with mocks)\r\n- [ ] Integration tests green\r\n- [ ] (Optional) E2E smoke planned/run\r\n\r\n---\r\n\r\n## 7) PowerShell CLI Notes (local runs)\r\n- Default shell is PowerShell on Windows.\r\n- Avoid `&&`; use `;` or PowerShell constructs.\r\n- Line continuation: backtick `` ` ``\r\n- Env vars: `$env:VAR = \"value\"`\r\n\r\n---\r\n\r\n## 8) References\r\n- Global workflows: `.clinerules/clineWorkflows.md`\r\n- Implementation Requirements (per subtask): `/Implementation/<id>-Implementation_Requirements_Tester.md`\r\n- Roadmap: `Docs/NewAgent/MVP_Roadmap_AgentTrio_v2.md` (M6 includes adopting this tester workflow)\r\n- Branching & PR Policy: `.clinerules/workflows/Branching_and_PR_Policy.md`\r\n\r\n---\r\n\r\n## 9) Agent AI Notes (Devon & Tara)\r\n- Default stance: Devon aims for production‚Äëready code **within current scope**. Do not overbuild; tests + requirements are the contract.\r\n- Tara‚Äôs role is to make failures meaningful (Good Red vs Bad Red) and test harness stable:\r\n  - Prefer explicit, localized mocks (no external calls). Use MSW for frontend integration, Supertest for backend.\r\n  - Control timers when testing retry/timeout: use fake timers and advance appropriately; when mocking `AbortController`, ensure abort listeners trigger.\r\n  - Reset `fetch`/HTTP mocks in `beforeEach` to avoid cross‚Äëtest leakage.\r\n- Assertions should target behavior and contracts (status codes, envelope fields), not internal implementation details.\r\n\r\n## 10) Task Log Maintenance (Open Questions)\r\nWhen a tester addresses an open question documented in a task log (`Agents/logs/<id>.yml`), they must:\r\n1. Update the `openQuestions` section for the relevant question:\r\n   - Change `status` from `open` to `answered`\r\n   - Update `notes` with a brief explanation of how the question was resolved\r\n   - Add a reference to any test files or documentation changes made\r\n2. Update the log's metadata:\r\n   - Set `lastUpdated` to current ISO‚Äë8601 timestamp\r\n   - Set `updatedBy` to `tester`\r\n3. Follow the silent‚Äëupdate protocol (no file preview) and post a one‚Äëline confirmation in chat.\r\n\r\n**Handling Blockers:**\r\n- If you have a question or hit a blocker (e.g., missing tool):\r\n  - Add it to the `openQuestions` or `notes` section of the Log.\r\n  - Do NOT stop completely. Continue writing other tests if possible.\r\n  - Only stop if you are 100% blocked on all fronts.\r\n\r\nExample update for an answered question:\r\n```yaml\r\nopenQuestions:\r\n  - key: example-question\r\n    status: answered\r\n    notes: \"Added integration tests for edge case; see frontend/src/__tests__/integration/example.test.js\"\r\n```\r\n\r\nThis ensures the task log remains an accurate SSOT‚Äëlite for the subtask and provides traceability for decisions.\r\n\r\n---\r\n\r\n## 11) Timeboxing & Escalation (Tester)\r\n- Follow `.clinerules/workflows/EscalationPolicy.md` when encountering tooling/test runner issues (e.g., Jest/Vitest, jsdom, Vue SFC transforms).\r\n- Triggers for escalation: AI agents at ‚â• 30 minutes OR after ‚â• 2 failed distinct attempts; human operators at ‚â• 45 minutes OR ‚â• 3 attempts; OR if the runner cannot execute a trivial spec.\r\n- On trigger: mark the subtask `blocked` in `Agents/manifest.yml`, create/update an `openQuestions` entry (e.g., `test-runner-setup`), and write a summary in `Agents/logs/<subtask-id>.yml` (errors, attempts, env, proposed next step). Post a one-line confirmation in chat per silent-update protocol.\r\n- Defaults: Vue 3 + Vite should prefer Vitest unless the repo explicitly mandates Jest. If Jest is mandated, repo must include a working config and a trivial smoke spec.\r\n- Do not continue implementation on tasks where the test runner smoke fails; surface the block and await triage from Architect/Developer.\r\n"
  },
  "environment_reminders": [
    "You are running on Windows PowerShell.",
    "Do NOT use '&&'. Use ';' for sequential commands.",
    "Do NOT use 'export VAR=val'. Use '$env:VAR = \"val\"'.",
    "Prefer relative paths."
  ],
  "instructions": "ACT as the assigned role. FOLLOW the 'Canonical Loop' defined in the Log. UPDATE the log checklists as you complete items."
}