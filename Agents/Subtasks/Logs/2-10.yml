id: "2-10"
title: "REST API Endpoints"
status: in_progress
outcome: pending
branch: "subtask/2-10-rest-api-endpoints"
dependencies: ["2-2", "2-3", "2-5"]
relevantFiles:
  - "backend/src/routes/subtasks.js"
  - "backend/src/routes/agents.js"
  - "backend/src/routes/events.js"
requiredActions:
  - "GET /api/subtasks — List all subtasks"
  - "GET /api/subtasks/:id — Get subtask details + log"
  - "POST /api/subtasks/:id/start — Trigger workflow for subtask"
  - "POST /api/subtasks/:id/approve — Orion approves completion"
  - "GET /api/agents/status — Current state of each agent"
  - "GET /api/events — Recent event history"
verificationChecklist:
  - "[x] [TDD] Failing Unit Tests created (Red)"
  - "[~] [TDD] Implementation satisfies Unit Tests (Green) - 12/13 passing"
  - "[ ] [TDD] Refactor pass (Cleanup)"
  - "[ ] [TDD] Integration Tests (Red → Green)"
  - "[ ] [TDD] Final verification and coverage > 80%"
  - "[x] All endpoints respond correctly"
  - "[~] Error cases handled - JSON body parsing edge case failing"
  - "[ ] Dashboard can fetch data"
prChecklist:
  developer: []
  tester: []
prChecklistStatus:
  developer: pending
  tester: pending
  orchestrator: pending
openQuestions: []
notes:
  - "These endpoints wire the dashboard to the backend."
  - "⚠️ BRANCH CHECK: Run 'git branch' - must show * subtask/2-10-rest-api-endpoints"
  - "TARA INSTRUCTIONS (Create failing tests - Red):"
  - "  - Create backend/__tests__/unit/routes.test.js ✓"
  - "  - Test: GET /api/subtasks returns list ✓"
  - "  - Test: GET /api/subtasks/:id returns subtask + log ✓"
  - "  - Test: GET /api/subtasks/:id returns 404 for unknown id ✓"
  - "  - Test: POST /api/subtasks/:id/start triggers workflow ✓"
  - "  - Test: POST /api/subtasks/:id/approve marks complete ✓"
  - "  - Test: GET /api/agents/status returns agent states ✓"
  - "  - Test: GET /api/events returns recent events ✓"
  - "  - Test: Error responses have correct format ✓"
  - "  - Use supertest to test Express routes ✓"
  - "TESTS STATUS: 13 unit tests. Implementation done by Devon - 12/13 passing."
  - "---"
  - "ORION FIX: Lazy DB pool initialization + removed deprecated wildcard route."
  - "REMAINING: 1 test failing - JSON error response for invalid JSON body."
  - "  - Test: 'should return JSON error response for invalid JSON'"
  - "  - Issue: Response body is {} instead of { error: '...' }"
  - "  - This is an edge case - core functionality works."
  - "---"
  - "RUN TESTS: cd backend; npm test -- --testPathPatterns=routes --forceExit"
lastUpdated: 2025-12-05T14:00:00Z
updatedBy: orion
