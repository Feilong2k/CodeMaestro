# Subtask Log: 5-10 (Stabilization)
id: "5-10"
title: "Stabilization (TacticalAdapter & Pathing)"
status: pending
branch: "subtask/5-10-stabilization"

constraint_discovery:
  subtask_id: "5-10"
  owner: "Devon"
  concern: "Hallucinations & Context Safety"
  date: "2025-12-09"
  
  atomic_actions:
    - action: "Refactor TacticalAdapter"
      description: "Remove keyword forcing logic"
    - action: "Update OrionAgent"
      description: "Inject default CWD into system prompt"
      
  resources_touched:
    - resource: "LLM API"
      action: "Prompt Construction"
      notes: "Must not confuse model with conflicting instructions"
    - resource: "File System"
      action: "Path Resolution"
      notes: "Relative paths must resolve safely"
      
  resource_physics:
    - resource: "LLM Prompt"
      constraint: "Instruction Priority"
      risk: "Model ignores 'don't hallucinate' if 'tool_choice: required' is set"
      mitigation: "Use 'tool_choice: auto' and explicit prompt instructions"
    - resource: "File System"
      constraint: "Process CWD"
      risk: "Node process CWD != User Mental CWD"
      mitigation: "Explicitly inject 'Working Directory: X' into prompt"
      
  verification:
    - action: "Chat Test"
      method: "Ask 'How do I create a file?' - Ensure NO tool calls"
    - action: "Path Test"
      method: "Ask 'List files here' without project - Ensure it lists CWD"

history:
  - ts: "2025-12-09T01:25:00Z"
    role: orchestrator
    action: CREATED
    message: "Log initialized. Focus on stopping hallucinations and fixing path resolution."

requiredActions:
  - "Logic: Remove `isActionRequest` logic in `TacticalAdapter.js`"
  - "Logic: Simplify `buildFunctionCallingPrompt` instructions"
  - "Logic: Update `OrionAgent.js` to inject fallback context"

verificationChecklist:
  - "[x] [TDD] 'How to' questions do not trigger tools"
  - "[ ] [TDD] Relative paths resolve correctly in default mode"

notes:
  - "Refactor of TacticalAdapter completed by Adam (Internal)"
  - "Hallucination Fix Verified: backend/src/__tests__/unit/TacticalAdapter_Fix.test.js PASSED"
  - "OrionAgent update PENDING for Devon"
