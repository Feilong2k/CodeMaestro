id: "2-3"
title: "State Machine (XState)"
status: pending
outcome: pending
branch: "subtask/2-3-state-machine-xstate"
dependencies: ["2-1"]
relevantFiles:
  - "backend/src/services/orchestrator.js"
  - "backend/src/machines/subtaskMachine.js"
requiredActions:
  - "States: pending, in_progress, red, green, refactor, integration_red, integration_green, verification, completed, blocked, failed"
  - "Transitions: Define all valid state changes"
  - "Guards: Rules for each transition (e.g., tests must exist before green)"
  - "Actions: Side effects on transition (notify agent, log event)"
  - "Persistence: Save state to DB on every transition"
  - "Service: OrchestratorService wraps XState machine"
verificationChecklist:
  - "[x] [TDD] Failing Unit Tests created (Red)"
  - "[ ] [TDD] Implementation satisfies Unit Tests (Green)"
  - "[ ] [TDD] Refactor pass (Cleanup)"
  - "[ ] [TDD] Integration Tests (Red → Green)"
  - "[ ] [TDD] Final verification and coverage > 80%"
  - "[ ] All states defined"
  - "[ ] Invalid transitions rejected"
  - "[ ] State persists across restarts"
prChecklist:
  developer: []
  tester: []
prChecklistStatus:
  developer: pending
  tester: pending
  orchestrator: pending
openQuestions: []
notes:
  - "XState v5 recommended. This is the core TDD workflow logic."
  - "⚠️ BRANCH CHECK: Run 'git branch' - must show * subtask/2-3-state-machine-xstate"
  - "UNIT TESTS CREATED: backend/__tests__/unit/orchestrator.test.js"
  - "---"
  - "DEVON INSTRUCTIONS (Make tests pass - Green):"
  - "  1. Install xstate: npm install xstate"
  - "  2. Create backend/src/machines/subtaskMachine.js with all TDD states"
  - "  3. Create backend/src/services/orchestrator.js with OrchestratorService"
  - "  4. Implement transition methods and state persistence"
  - "  5. Run tests: cd backend; npm test -- --testPathPattern=orchestrator"
lastUpdated: 2025-12-05T02:30:00Z
updatedBy: orion
