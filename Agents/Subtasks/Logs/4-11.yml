# Subtask Log: 4-11 (Context Pruning Logic)
id: "4-11"
title: "Context Pruning Logic"
status: pending
branch: "subtask/4-11-context-pruning"

history:
  - ts: "2025-12-07T13:15:00Z"
    role: orchestrator
    action: CREATED
    message: "Log initialized. This task focuses on optimizing the context window by summarizing completed steps."

requiredActions:
  - "Logic: Implement `ContextPruner` class in `backend/src/services/ai/`"
  - "Logic: `summarizeHistory(messages)`: Compress older messages into a summary block"
  - "Logic: `optimizeContext(currentTask)`: Keep only relevant recent history + summary"
  - "Integration: Update `AiService` to use `ContextPruner` before sending prompts"
  - "Config: Add token limits/thresholds to `config/ai.js`"

verificationChecklist:
  - "[ ] [TDD] Failing Unit Tests created (Red)"
  - "[ ] [TDD] Implementation satisfies Unit Tests (Green)"
  - "[ ] Pruner correctly identifies completed steps vs active steps"
  - "[ ] Summary generation works (mocked or actual LLM call)"
  - "[ ] Context size is reduced after pruning"
  - "[ ] Critical context (Active Task) is PRESERVED"

openQuestions: []

